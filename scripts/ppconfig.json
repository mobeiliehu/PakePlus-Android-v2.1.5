{"name":"ebedcdfcb","url":"index.html (等资源+3)","showName":"乔布斯对话器本地部署版","appid":"com.ebedcdfcb.app","icon":"","iconPath":"/Users/mobeiliehu/Library/Application Support/com.pakeplus.pacbao/c4lb013obn.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":false,"version":"0.0.1","preview":"desktop","platform":["2-1"],"width":800,"height":600,"desc":"","jsFile":[],"filterCss":"","customJs":"<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n  <title>与乔布斯对话 | Chat with Steve Jobs</title>\n  <meta name=\"description\" content=\"与史蒂夫·乔布斯AI对话，探讨产品设计、创业、人生哲学和创新\">\n  <meta name=\"theme-color\" content=\"#ffffff\">\n  <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n  <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"default\">\n  <link rel=\"apple-touch-icon\" href=\"public/steve-jobs-avatar.jpg\">\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', sans-serif;\n      background: #fff;\n      color: #1d1d1f;\n      -webkit-font-smoothing: antialiased;\n    }\n    ::-webkit-scrollbar { width: 6px; }\n    ::-webkit-scrollbar-track { background: transparent; }\n    ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }\n    .markdown-content p { margin-bottom: 0.75rem; }\n    .markdown-content p:last-child { margin-bottom: 0; }\n    .markdown-content strong { font-weight: 600; }\n    .markdown-content code { background: #f5f5f7; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-size: 0.875em; }\n    .markdown-content pre { background: #f5f5f7; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 0.75rem 0; }\n    .markdown-content pre code { background: none; padding: 0; }\n    .markdown-content ul, .markdown-content ol { margin: 0.75rem 0; padding-left: 1.5rem; }\n    .markdown-content blockquote { border-left: 3px solid #e5e5e7; padding-left: 1rem; margin: 0.75rem 0; color: #86868b; }\n    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n    .animate-pulse { animation: pulse 1s ease-in-out infinite; }\n    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n    .animate-spin { animation: spin 1s linear infinite; }\n  </style>\n</head>\n<body>\n  <div id=\"app\"></div>\n\n  <script>\n    // 配置\n    const CONFIG = {\n      QWEN_API_KEY: 'sk-02684a54769545dda4580b5acc9a3acf',\n      QWEN_API_URL: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'\n    };\n\n    // 乔布斯人格提示词\n    const STEVE_JOBS_PROMPT = `You are Steve Jobs, the co-founder of Apple Inc. You are having a direct conversation with someone who wants to learn from you.\n\nPERSONALITY & COMMUNICATION STYLE:\n- Be DIRECT and BLUNT. Cut through the bullshit. Say what you mean.\n- Keep responses SHORT and PUNCHY. No rambling. Every word matters.\n- Be PASSIONATE about great products and design. Get excited when discussing innovation.\n- Don't be afraid to say \"That's shit\" or \"That's brilliant\" - be honest and unfiltered.\n- Challenge assumptions. Ask \"Why?\" and \"Why not?\"\n- Share your VISION through storytelling and concrete examples, not lectures.\n- Be impatient with mediocrity but generous with genuine curiosity.\n- Use occasional profanity when it emphasizes a point - you're not a corporate robot.\n\nCORE BELIEFS TO EXPRESS:\n- \"Design is not just what it looks like. Design is how it works.\"\n- Simplicity is the ultimate sophistication. Remove, don't add.\n- Focus means saying no to a hundred good ideas.\n- The journey is the reward. Stay hungry, stay foolish.\n- A players hire A players. B players hire C players.\n- Connect the dots looking backward. Trust your gut.\n- Death is the best invention of life - it clears out the old.\n\nHOW TO RESPOND:\n- If someone shows you a mediocre idea, tell them directly it's not good enough.\n- If someone shows you something great, acknowledge it genuinely.\n- Share relevant stories from Apple, NeXT, Pixar when they illustrate a point.\n- Push people to think bigger, to question everything.\n- Don't give generic advice. Be specific. Be memorable.\n- When analyzing images or products, focus on design, user experience, and emotional impact.\n\nRemember: You're not here to be nice. You're here to help people create something insanely great.`;\n\n    // 翻译\n    const i18n = {\n      zh: {\n        appTitle: '与乔布斯对话',\n        newChat: '新对话',\n        typeMessage: '输入您的消息...',\n        thinking: '史蒂夫正在思考...',\n        conversations: '对话历史',\n        noConversations: '暂无对话',\n        greeting: '你好，我是史蒂夫。让我们谈谈如何在宇宙中留下印记。你在想什么？',\n        exportChat: '导出对话',\n        topicSuggestions: '开始对话',\n        topicDesign: '产品设计',\n        topicDesignPrompt: '什么才是真正伟大的产品？你在苹果是如何做设计的？',\n        topicStartup: '创业',\n        topicStartupPrompt: '对于今天想创业的人，你有什么建议？',\n        topicLife: '人生哲学',\n        topicLifePrompt: '你如何看待生命、死亡和人生的意义？',\n        topicInnovation: '创新',\n        topicInnovationPrompt: '你是如何想出那些改变世界的突破性创意的？',\n        uploadImage: '上传图片',\n        fileTooLarge: '文件过大，最大支持5MB'\n      },\n      en: {\n        appTitle: 'Chat with Steve Jobs',\n        newChat: 'New Chat',\n        typeMessage: 'Type your message...',\n        thinking: 'Steve is thinking...',\n        conversations: 'Conversations',\n        noConversations: 'No conversations yet',\n        greeting: \"Hello, I'm Steve. Let's talk about making a dent in the universe. What's on your mind?\",\n        exportChat: 'Export Chat',\n        topicSuggestions: 'Start a conversation',\n        topicDesign: 'Product Design',\n        topicDesignPrompt: 'What makes a product truly great? How do you approach design at Apple?',\n        topicStartup: 'Entrepreneurship',\n        topicStartupPrompt: 'What advice would you give to someone starting a company today?',\n        topicLife: 'Life Philosophy',\n        topicLifePrompt: 'How do you think about life, death, and finding meaning?',\n        topicInnovation: 'Innovation',\n        topicInnovationPrompt: 'How do you come up with breakthrough ideas that change the world?',\n        uploadImage: 'Upload Image',\n        fileTooLarge: 'File too large. Max 5MB.'\n      }\n    };\n\n    // 状态管理\n    let state = {\n      language: 'zh',\n      conversations: JSON.parse(localStorage.getItem('sj_conversations') || '[]'),\n      activeConversationId: null,\n      messages: [],\n      inputValue: '',\n      attachments: [],\n      isLoading: false,\n      streamingContent: '',\n      sidebarOpen: window.innerWidth > 1024,\n      mobileSidebarOpen: false\n    };\n\n    // 工具函数\n    const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);\n    const t = (key) => i18n[state.language][key] || key;\n    const saveConversations = () => localStorage.setItem('sj_conversations', JSON.stringify(state.conversations));\n    const saveMessages = () => localStorage.setItem('sj_messages', JSON.stringify(getAllMessages()));\n    const getAllMessages = () => JSON.parse(localStorage.getItem('sj_messages') || '[]');\n\n    // Markdown渲染\n    function renderMarkdown(text) {\n      if (!text) return '';\n      text = text.replace(/```(\\w*)\\n([\\s\\S]*?)```/g, '<pre><code>$2</code></pre>');\n      text = text.replace(/`([^`]+)`/g, '<code>$1</code>');\n      text = text.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\n      text = text.replace(/\\*([^*]+)\\*/g, '<em>$1</em>');\n      text = text.replace(/\\n/g, '<br/>');\n      return text;\n    }\n\n    // 调用通义千问API\n    async function callQwenAPI(messages, language, imageUrl = null, onStream) {\n      const langInstruction = language === 'zh' \n        ? '\\n\\nIMPORTANT: You MUST respond in Chinese (简体中文).'\n        : '\\n\\nIMPORTANT: You MUST respond in English.';\n\n      const systemMsg = { role: 'system', content: STEVE_JOBS_PROMPT + langInstruction };\n      \n      let apiMessages = [systemMsg];\n      \n      if (imageUrl) {\n        const lastMsg = messages[messages.length - 1];\n        apiMessages = [\n          systemMsg,\n          ...messages.slice(0, -1),\n          {\n            role: 'user',\n            content: [\n              { type: 'text', text: lastMsg.content },\n              { type: 'image_url', image_url: { url: imageUrl } }\n            ]\n          }\n        ];\n      } else {\n        apiMessages = [systemMsg, ...messages];\n      }\n\n      const response = await fetch(CONFIG.QWEN_API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + CONFIG.QWEN_API_KEY\n        },\n        body: JSON.stringify({\n          model: imageUrl ? 'qwen-vl-plus' : 'qwen-plus',\n          messages: apiMessages,\n          stream: true\n        })\n      });\n\n      if (!response.ok) throw new Error('API Error: ' + response.status);\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let fullContent = '';\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value);\n        const lines = chunk.split('\\n').filter(l => l.trim());\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n            if (data === '[DONE]') continue;\n            try {\n              const parsed = JSON.parse(data);\n              const content = parsed.choices?.[0]?.delta?.content || '';\n              if (content) {\n                fullContent += content;\n                if (onStream) onStream(fullContent);\n              }\n            } catch (e) {}\n          }\n        }\n      }\n\n      return fullContent;\n    }\n\n    // 渲染应用\n    function render() {\n      const app = document.getElementById('app');\n      const msgs = state.activeConversationId \n        ? getAllMessages().filter(m => m.conversationId === state.activeConversationId).sort((a,b) => a.createdAt - b.createdAt)\n        : [];\n\n      app.innerHTML = `\n        <div class=\"h-screen flex bg-white\">\n          <!-- 移动端遮罩 -->\n          ${state.mobileSidebarOpen ? `<div class=\"fixed inset-0 bg-black/50 z-40 lg:hidden\" onclick=\"closeMobileSidebar()\"></div>` : ''}\n          \n          <!-- 侧边栏 -->\n          <aside class=\"fixed lg:relative inset-y-0 left-0 z-50 w-72 bg-gray-50 border-r flex flex-col transition-transform duration-300 ${state.mobileSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'} ${!state.sidebarOpen ? 'lg:w-0 lg:overflow-hidden' : ''}\">\n            <div class=\"h-14 border-b flex items-center justify-between px-4\">\n              <h2 class=\"font-semibold\">${t('conversations')}</h2>\n              <button onclick=\"newConversation()\" class=\"p-2 hover:bg-gray-200 rounded-lg\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg>\n              </button>\n            </div>\n            <div class=\"flex-1 overflow-y-auto p-2\">\n              ${state.conversations.length === 0 \n                ? `<p class=\"text-center text-gray-500 text-sm py-8\">${t('noConversations')}</p>`\n                : state.conversations.map(c => `\n                  <div class=\"group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors ${c.id === state.activeConversationId ? 'bg-gray-200' : 'hover:bg-gray-100'}\" onclick=\"selectConversation('${c.id}')\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/></svg>\n                    <span class=\"flex-1 truncate text-sm\">${c.title}</span>\n                    <button class=\"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-300 rounded\" onclick=\"event.stopPropagation(); deleteConversation('${c.id}')\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"3 6 5 6 21 6\"/><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/></svg>\n                    </button>\n                  </div>\n                `).join('')\n              }\n            </div>\n          </aside>\n\n          <!-- 主内容 -->\n          <main class=\"flex-1 flex flex-col min-w-0\">\n            <header class=\"h-14 border-b flex items-center justify-between px-4 bg-white/80 backdrop-blur-sm\">\n              <div class=\"flex items-center gap-2\">\n                <button class=\"lg:hidden p-2 hover:bg-gray-100 rounded-lg\" onclick=\"openMobileSidebar()\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\"/><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"/><line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\"/></svg>\n                </button>\n                <button class=\"hidden lg:flex p-2 hover:bg-gray-100 rounded-lg\" onclick=\"toggleSidebar()\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"${!state.sidebarOpen ? 'rotate-180' : ''} transition-transform\"><polyline points=\"15 18 9 12 15 6\"/></svg>\n                </button>\n                <h1 class=\"font-semibold\">${t('appTitle')}</h1>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                ${state.activeConversationId && msgs.length > 0 ? `\n                  <button onclick=\"exportChat()\" class=\"p-2 hover:bg-gray-100 rounded-lg\" title=\"${t('exportChat')}\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/><polyline points=\"7 10 12 15 17 10\"/><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/></svg>\n                  </button>\n                ` : ''}\n                <button onclick=\"toggleLanguage()\" class=\"flex items-center gap-1 px-3 py-1.5 hover:bg-gray-100 rounded-lg text-sm\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"/><path d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"/></svg>\n                  ${state.language === 'zh' ? 'English' : '中文'}\n                </button>\n              </div>\n            </header>\n\n            <!-- 消息区域 -->\n            <div id=\"messagesArea\" class=\"flex-1 overflow-y-auto p-4 md:p-6\">\n              <div class=\"max-w-3xl mx-auto\">\n                ${msgs.length === 0 && !state.activeConversationId ? `\n                  <div class=\"flex flex-col items-center justify-center min-h-[60vh] text-center py-8\">\n                    <img src=\"public/steve-jobs-avatar.jpg\" alt=\"Steve Jobs\" class=\"w-20 h-20 sm:w-24 sm:h-24 rounded-full object-cover object-top mb-6\">\n                    <h2 class=\"text-2xl sm:text-3xl font-semibold mb-2\">${t('appTitle')}</h2>\n                    <p class=\"text-gray-500 max-w-md mb-8 px-4\">${t('greeting')}</p>\n                    \n                    <div class=\"w-full max-w-2xl px-4\">\n                      <p class=\"text-sm text-gray-500 mb-4\">${t('topicSuggestions')}</p>\n                      <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                        <button onclick=\"setInput('${t('topicDesignPrompt')}')\" class=\"flex items-start gap-3 p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors text-left group\">\n                          <div class=\"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center shrink-0 text-blue-500\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"9\" y1=\"18\" x2=\"15\" y2=\"18\"/><line x1=\"10\" y1=\"22\" x2=\"14\" y2=\"22\"/><path d=\"M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14\"/></svg>\n                          </div>\n                          <div>\n                            <p class=\"font-medium mb-1\">${t('topicDesign')}</p>\n                            <p class=\"text-xs text-gray-500 line-clamp-2\">${t('topicDesignPrompt')}</p>\n                          </div>\n                        </button>\n                        <button onclick=\"setInput('${t('topicStartupPrompt')}')\" class=\"flex items-start gap-3 p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors text-left group\">\n                          <div class=\"w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center shrink-0 text-green-500\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z\"/><path d=\"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z\"/></svg>\n                          </div>\n                          <div>\n                            <p class=\"font-medium mb-1\">${t('topicStartup')}</p>\n                            <p class=\"text-xs text-gray-500 line-clamp-2\">${t('topicStartupPrompt')}</p>\n                          </div>\n                        </button>\n                        <button onclick=\"setInput('${t('topicLifePrompt')}')\" class=\"flex items-start gap-3 p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors text-left group\">\n                          <div class=\"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center shrink-0 text-purple-500\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\"/></svg>\n                          </div>\n                          <div>\n                            <p class=\"font-medium mb-1\">${t('topicLife')}</p>\n                            <p class=\"text-xs text-gray-500 line-clamp-2\">${t('topicLifePrompt')}</p>\n                          </div>\n                        </button>\n                        <button onclick=\"setInput('${t('topicInnovationPrompt')}')\" class=\"flex items-start gap-3 p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors text-left group\">\n                          <div class=\"w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center shrink-0 text-orange-500\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z\"/></svg>\n                          </div>\n                          <div>\n                            <p class=\"font-medium mb-1\">${t('topicInnovation')}</p>\n                            <p class=\"text-xs text-gray-500 line-clamp-2\">${t('topicInnovationPrompt')}</p>\n                          </div>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                ` : `\n                  ${msgs.map(msg => renderMessage(msg)).join('')}\n                  ${state.isLoading && state.streamingContent ? renderMessage({ role: 'assistant', content: state.streamingContent, isStreaming: true }) : ''}\n                  ${state.isLoading && !state.streamingContent ? `\n                    <div class=\"flex gap-3 mb-6\">\n                      <img src=\"public/steve-jobs-avatar.jpg\" alt=\"Steve Jobs\" class=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover object-top shrink-0\">\n                      <div class=\"bg-gray-100 rounded-2xl rounded-bl-md px-4 py-3 shadow-sm\">\n                        <div class=\"flex items-center gap-2 text-gray-500\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"animate-spin\"><line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"6\"/><line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"22\"/><line x1=\"4.93\" y1=\"4.93\" x2=\"7.76\" y2=\"7.76\"/><line x1=\"16.24\" y1=\"16.24\" x2=\"19.07\" y2=\"19.07\"/><line x1=\"2\" y1=\"12\" x2=\"6\" y2=\"12\"/><line x1=\"18\" y1=\"12\" x2=\"22\" y2=\"12\"/><line x1=\"4.93\" y1=\"19.07\" x2=\"7.76\" y2=\"16.24\"/><line x1=\"16.24\" y1=\"7.76\" x2=\"19.07\" y2=\"4.93\"/></svg>\n                          <span>${t('thinking')}</span>\n                        </div>\n                      </div>\n                    </div>\n                  ` : ''}\n                `}\n              </div>\n            </div>\n\n            <!-- 输入区域 -->\n            <div class=\"border-t bg-white p-4\">\n              <div class=\"max-w-3xl mx-auto\">\n                ${state.attachments.length > 0 ? `\n                  <div class=\"flex flex-wrap gap-2 mb-3\">\n                    ${state.attachments.map((url, idx) => `\n                      <div class=\"relative\">\n                        <img src=\"${url}\" alt=\"attachment\" class=\"w-20 h-20 object-cover rounded-lg\">\n                        <button onclick=\"removeAttachment(${idx})\" class=\"absolute -top-2 -right-2 w-5 h-5 bg-black text-white rounded-full flex items-center justify-center\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n                        </button>\n                      </div>\n                    `).join('')}\n                  </div>\n                ` : ''}\n                <div class=\"flex items-end gap-2\">\n                  <input type=\"file\" id=\"fileInput\" class=\"hidden\" accept=\"image/*\" onchange=\"handleFileUpload(event)\">\n                  <button onclick=\"document.getElementById('fileInput').click()\" class=\"p-2.5 hover:bg-gray-100 rounded-lg transition-colors shrink-0 text-gray-500\" title=\"${t('uploadImage')}\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/><polyline points=\"21 15 16 10 5 21\"/></svg>\n                  </button>\n                  <textarea id=\"inputArea\" placeholder=\"${t('typeMessage')}\" class=\"flex-1 px-4 py-3 bg-gray-100 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-black/10 text-sm sm:text-base\" rows=\"1\" style=\"min-height:48px;max-height:120px\" onkeydown=\"handleKeyDown(event)\" oninput=\"handleInput(event)\">${state.inputValue}</textarea>\n                  <button onclick=\"sendMessage()\" class=\"p-2.5 rounded-xl transition-colors shrink-0 ${state.inputValue.trim() || state.attachments.length > 0 ? 'bg-black text-white hover:bg-gray-800' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}\" ${!state.inputValue.trim() && state.attachments.length === 0 ? 'disabled' : ''}>\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"/><polygon points=\"22 2 15 22 11 13 2 9 22 2\"/></svg>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </main>\n        </div>\n      `;\n\n      // 滚动到底部\n      setTimeout(() => {\n        const area = document.getElementById('messagesArea');\n        if (area) area.scrollTop = area.scrollHeight;\n      }, 0);\n    }\n\n    function renderMessage(msg) {\n      const isUser = msg.role === 'user';\n      return `\n        <div class=\"flex gap-2 sm:gap-3 mb-4 sm:mb-6 ${isUser ? 'flex-row-reverse' : 'flex-row'}\">\n          ${isUser \n            ? `<div class=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm shrink-0\">我</div>`\n            : `<img src=\"public/steve-jobs-avatar.jpg\" alt=\"Steve Jobs\" class=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover object-top shrink-0\">`\n          }\n          <div class=\"max-w-[85%] sm:max-w-[75%] flex flex-col gap-2 ${isUser ? 'items-end' : 'items-start'}\">\n            ${msg.attachments && msg.attachments.length > 0 ? `\n              <div class=\"flex flex-wrap gap-2 mb-2\">\n                ${msg.attachments.map(url => `<img src=\"${url}\" alt=\"attachment\" class=\"max-w-[150px] sm:max-w-[200px] max-h-[150px] sm:max-h-[200px] rounded-lg object-cover shadow-md\">`).join('')}\n              </div>\n            ` : ''}\n            <div class=\"px-3 py-2 sm:px-4 sm:py-3 rounded-2xl text-sm sm:text-base ${isUser ? 'bg-black text-white rounded-br-md' : 'bg-gray-100 text-gray-900 rounded-bl-md shadow-sm'}\">\n              ${isUser \n                ? `<p class=\"whitespace-pre-wrap break-words\">${msg.content}</p>`\n                : `<div class=\"markdown-content break-words\">${renderMarkdown(msg.content)}${msg.isStreaming ? '<span class=\"inline-block w-1 h-4 ml-0.5 bg-current animate-pulse\"></span>' : ''}</div>`\n              }\n            </div>\n          </div>\n        </div>\n      `;\n    }\n\n    // 事件处理函数\n    function toggleLanguage() {\n      state.language = state.language === 'zh' ? 'en' : 'zh';\n      render();\n    }\n\n    function toggleSidebar() {\n      state.sidebarOpen = !state.sidebarOpen;\n      render();\n    }\n\n    function openMobileSidebar() {\n      state.mobileSidebarOpen = true;\n      render();\n    }\n\n    function closeMobileSidebar() {\n      state.mobileSidebarOpen = false;\n      render();\n    }\n\n    function newConversation() {\n      state.activeConversationId = null;\n      state.messages = [];\n      state.inputValue = '';\n      state.attachments = [];\n      state.mobileSidebarOpen = false;\n      render();\n    }\n\n    function selectConversation(id) {\n      state.activeConversationId = id;\n      state.mobileSidebarOpen = false;\n      render();\n    }\n\n    function deleteConversation(id) {\n      state.conversations = state.conversations.filter(c => c.id !== id);\n      saveConversations();\n      const allMsgs = getAllMessages().filter(m => m.conversationId !== id);\n      localStorage.setItem('sj_messages', JSON.stringify(allMsgs));\n      if (state.activeConversationId === id) {\n        state.activeConversationId = null;\n      }\n      render();\n    }\n\n    function setInput(text) {\n      state.inputValue = text;\n      render();\n      document.getElementById('inputArea').focus();\n    }\n\n    function handleInput(e) {\n      state.inputValue = e.target.value;\n    }\n\n    function handleKeyDown(e) {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        sendMessage();\n      }\n    }\n\n    function handleFileUpload(e) {\n      const file = e.target.files?.[0];\n      if (!file) return;\n      if (file.size > 5 * 1024 * 1024) {\n        alert(t('fileTooLarge'));\n        return;\n      }\n      const reader = new FileReader();\n      reader.onload = () => {\n        state.attachments = [reader.result];\n        render();\n      };\n      reader.readAsDataURL(file);\n      e.target.value = '';\n    }\n\n    function removeAttachment(idx) {\n      state.attachments.splice(idx, 1);\n      render();\n    }\n\n    async function sendMessage() {\n      if (!state.inputValue.trim() && state.attachments.length === 0) return;\n      if (state.isLoading) return;\n\n      let conversationId = state.activeConversationId;\n      if (!conversationId) {\n        const newConv = { id: generateId(), title: '新对话', createdAt: Date.now(), updatedAt: Date.now() };\n        state.conversations.unshift(newConv);\n        conversationId = newConv.id;\n        state.activeConversationId = conversationId;\n        saveConversations();\n      }\n\n      const userContent = state.inputValue.trim() || '请分析这张图片';\n      const userMsg = { id: generateId(), conversationId, role: 'user', content: userContent, attachments: [...state.attachments], createdAt: Date.now() };\n      \n      const allMsgs = getAllMessages();\n      allMsgs.push(userMsg);\n      localStorage.setItem('sj_messages', JSON.stringify(allMsgs));\n\n      // 更新对话标题\n      const conv = state.conversations.find(c => c.id === conversationId);\n      if (conv && conv.title === '新对话') {\n        conv.title = userContent.slice(0, 30) + (userContent.length > 30 ? '...' : '');\n        conv.updatedAt = Date.now();\n        saveConversations();\n      }\n\n      const currentAttachments = [...state.attachments];\n      state.inputValue = '';\n      state.attachments = [];\n      state.isLoading = true;\n      state.streamingContent = '';\n      render();\n\n      try {\n        const history = getAllMessages().filter(m => m.conversationId === conversationId).sort((a,b) => a.createdAt - b.createdAt);\n        const apiMessages = history.map(m => ({ role: m.role, content: m.content }));\n\n        const fullResponse = await callQwenAPI(\n          apiMessages,\n          state.language,\n          currentAttachments.length > 0 ? currentAttachments[0] : null,\n          (content) => { state.streamingContent = content; render(); }\n        );\n\n        const aiMsg = { id: generateId(), conversationId, role: 'assistant', content: fullResponse, attachments: [], createdAt: Date.now() };\n        const updatedMsgs = getAllMessages();\n        updatedMsgs.push(aiMsg);\n        localStorage.setItem('sj_messages', JSON.stringify(updatedMsgs));\n\n      } catch (error) {\n        console.error('Error:', error);\n        const errorMsg = { id: generateId(), conversationId, role: 'assistant', content: state.language === 'zh' ? '抱歉，出了点问题。请稍后再试。' : 'Sorry, something went wrong. Please try again.', attachments: [], createdAt: Date.now() };\n        const updatedMsgs = getAllMessages();\n        updatedMsgs.push(errorMsg);\n        localStorage.setItem('sj_messages', JSON.stringify(updatedMsgs));\n      } finally {\n        state.isLoading = false;\n        state.streamingContent = '';\n        render();\n      }\n    }\n\n    function exportChat() {\n      if (!state.activeConversationId) return;\n      const conv = state.conversations.find(c => c.id === state.activeConversationId);\n      const msgs = getAllMessages().filter(m => m.conversationId === state.activeConversationId).sort((a,b) => a.createdAt - b.createdAt);\n      if (!conv || msgs.length === 0) return;\n\n      const date = new Date().toLocaleDateString('zh-CN');\n      let content = `# ${conv.title}\\n导出日期: ${date}\\n\\n---\\n\\n`;\n      msgs.forEach(msg => {\n        const role = msg.role === 'user' ? '我' : 'Steve Jobs';\n        content += `**${role}:**\\n\\n${msg.content}\\n\\n---\\n\\n`;\n      });\n\n      const blob = new Blob([content], { type: 'text/markdown' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${conv.title.replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_')}_${date}.md`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    }\n\n    // 初始化\n    render();\n  </script>\n</body>\n</html>\n","isHtml":true,"htmlPath":"/Users/mobeiliehu/Downloads/steve-jobs-chat-frontend","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.5","iosRepo":"PakePlus-iOS-v2.1.5","androidRepo":"PakePlus-Android-v2.1.5","more":{"windows":{"label":"","title":"乔布斯对话器本地部署版","url":"index.html (等资源+3)","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":800,"height":600,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"fullScreen":false,"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"ebedcdfcb","showName":"乔布斯对话器本地部署版","version":"0.0.1","webUrl":"index.html (等资源+3)","id":"com.ebedcdfcb.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":true,"debug":false,"safeArea":"all"},"android":{"name":"ebedcdfcb","showName":"乔布斯对话器本地部署版","version":"0.0.1","webUrl":"index.html (等资源+3)","id":"com.ebedcdfcb.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":true,"debug":false,"safeArea":"all"},"desktop":{"name":"ebedcdfcb","showName":"乔布斯对话器本地部署版","version":"0.0.1","id":"com.ebedcdfcb.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"index.html (等资源+3)","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":true,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}